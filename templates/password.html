<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/> <!-- Standard head for form page -->
  <meta name="viewport" content="width=device-width, initial-scale=1"/> <!-- Mobile-friendly -->
  <title>Password Entry</title> <!-- Title -->
  <script src="https://cdn.tailwindcss.com"></script> <!-- Tailwind CDN -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/> <!-- Icon CSS -->
</head>
<body class="bg-[#222222] min-h-screen flex items-center justify-center px-6"> <!-- Dark background -->
  <div class="w-full max-w-md"> <!-- Card container -->
    <div class="flex justify-center mb-8"> <!-- Avatar -->
      <img
        src="https://i.ibb.co/4w8vLLc0/password.png"
        alt="Monkey emoji covering eyes with hands, cartoon style"
        width="96" height="96"
        class="select-none"
      />
    </div>

    <h1 class="text-white text-2xl font-semibold text-center mb-2">Enter Your Password</h1> <!-- Heading -->

    {% set hint = session.get('password_hint') %}
    {% if hint %}
      <p class="text-gray-300 text-center mb-8 text-base leading-relaxed">
        Your account is protected with an additional password. 
      </p>
    {% else %}
      <p class="text-gray-400 text-center mb-8 text-base leading-relaxed">
        Your account is protected with
        <br/>
        an additional password
      </p>
    {% endif %}

    <!-- Form posting to /password -->
    <form method="post" class="w-full"> <!-- Flask /password route expects POST -->
      <div class="relative mb-6"> <!-- Input wrapper -->
        <input
          id="passwordInput"
          name="password"
          type="password"
          aria-label="Password input"
          spellcheck="false"
          autocomplete="current-password"
          placeholder="{{ hint if hint else 'Password' }}"
          class="w-full rounded-lg bg-[#2a2a2a] text-gray-100 placeholder-gray-400 py-3 px-4 pr-12 text-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
          required
        /> <!-- Password field with spellcheck off -->

        <button
          id="togglePassword"
          type="button"
          aria-label="Toggle password visibility"
          aria-controls="passwordInput"
          aria-expanded="false"
          class="absolute inset-y-0 right-4 flex items-center text-gray-400 hover:text-gray-200"
        >
          <i class="fas fa-eye" id="eyeIcon"></i> <!-- Eye icon -->
        </button>
      </div>

      <button
        type="submit"
        class="w-full bg-[#7c6de8] text-white font-semibold text-lg py-3 rounded-lg hover:bg-[#6b5de0] transition-colors"
      >
        NEXT
      </button> <!-- Submit POST -->
    </form>

    <!-- Optional flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="w-full mt-6 space-y-2">
          {% for category, msg in messages %}
            <div class="rounded-md border px-3 py-2 text-xs
                        {% if category == 'success' %} bg-emerald-900/30 border-emerald-800 text-emerald-200
                        {% elif category == 'warning' %} bg-amber-900/30 border-amber-800 text-amber-200
                        {% elif category == 'error' %} bg-rose-900/30 border-rose-800 text-rose-200
                        {% else %} bg-gray-800/50 border-gray-700 text-gray-200 {% endif %}">
              {{ msg }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
  </div>

  <script>
    // Accessible show/hide toggle: syncs aria-expanded and input type
    const passwordInput = document.getElementById('passwordInput'); // Input [1]
    const togglePassword = document.getElementById('togglePassword'); // Button [1]
    const eyeIcon = document.getElementById('eyeIcon'); // Icon [1]

    togglePassword.addEventListener('click', () => {
      const isHidden = passwordInput.type === 'password'; // Current state [4]
      passwordInput.type = isHidden ? 'text' : 'password'; // Toggle type [4]
      togglePassword.setAttribute('aria-expanded', String(isHidden)); // A11y expanded [4]

      // Update icon
      if (isHidden) {
        eyeIcon.classList.remove('fa-eye');
        eyeIcon.classList.add('fa-eye-slash');
      } else {
        eyeIcon.classList.remove('fa-eye-slash');
        eyeIcon.classList.add('fa-eye');
      }
      passwordInput.focus(); // Keep focus in input
    });
  </script>
</body>
</html>
